{% extends "base.html" %}

{% block content %}
<div class="container mt-5">
    <h2 class="text-content mb-4">üìñ Emprunts en cours</h2>

    <!--barre de recherche et filfrage-->
    <div class="row mb-4">
        <div class="col-mb-6">
            <div class="input-group">
                <input type="text" class="form-control" id="searchInput" placeholder="Rechercher un emprunteur, livre ou auteur..." onkeyup="searchTable()">
                <span class="input-group-text"><i class="fas fa-search"></i></span>
            </div>
            <div class="col-md-6">
                <div class="input-group">
                    <select class="form-select" id="filterSelect" onchange="filterTable()">
                        <option value="">Filtrer par statut</option>
                        <option value="en_cours">En cours</option>
                        <option value="en_retard">En retard</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Tableau des emprunts -->
    <div class="table-responsive">
        <table class="table table-striped table-bordered" id="loansTable">
            <thead class="table-dark">
                <tr>
                    <th>Emprunteur</th>
                    <th>Livre</th>
                    <th>Auteur</th>
                    <th>Date d'emprunt</th>
                    <th>Date de retour pr√©vue</th>
                </tr>
            </thead>
            <tbody>
                <!-- Donn√©es statiques -->
                <tr>
                    <td>Jean Dupont</td>
                    <td>Le Petit Prince</td>
                    <td>Antoine de Saint-Exup√©ry</td>
                    <td>01/05/2025</td>
                    <td>15/05/2025</td>
                </tr>
                <tr>
                    <td>Marie Curie</td>
                    <td>1984</td>
                    <td>George Orwell</td>
                    <td>03/05/2025</td>
                    <td>17/05/2025</td>
                </tr>
                <tr>
                    <td>Ahmed Benali</td>
                    <td>L'√âtranger</td>
                    <td>Albert Camus</td>
                    <td>05/05/2025</td>
                    <td>19/05/2025</td>
                </tr>
                <tr>
                    <td>Sophie Martin</td>
                    <td>Les Mis√©rables</td>
                    <td>Victor Hugo</td>
                    <td>07/05/2025</td>
                    <td>21/05/2025</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- Script pour la recherche et le filtrage -->
<script>
    function searchTable() {
        let input = document.getElementById("searchInput").value.toLowerCase();
        let table = document.getElementById("loansTable");
        let rows = table.getElementsByTagName("tr");
    
        for (let i = 1; i < rows.length; i++) {
            let cells = rows[i].getElementsByTagName("td");
            let match = false;
            for (let j = 0; j < cells.length; j++) {
                if (cells[j].innerText.toLowerCase().includes(input)) {
                    match = true;
                    break;
                }
            }
            rows[i].style.display = match ? "" : "none";
        }
    }

    function filterTable() {
        let filter = document.getElementById("filterSelect").value;
        let table = document.getElementById("loansTable");
        let rows = table.getElementsByTagName("tr");
    
        for (let i = 1; i < rows.length; i++) {
            let dueDate = new Date(rows[i].getElementsByTagName("td")[4].innerText.split("/").reverse().join("-"));
            let today = new Date("2025-05-11");
            let isLate = dueDate < today;
    
            if (filter === "") {
                rows[i].style.display = "";
            } else if (filter === "en_cours" && !isLate) {
                rows[i].style.display = "";
            } else if (filter === "en_retard" && isLate) {
                rows[i].style.display = "";
            } else {
                rows[i].style.display = "none";
            }
        }
    }
    </script>
    {% endblock %}
    